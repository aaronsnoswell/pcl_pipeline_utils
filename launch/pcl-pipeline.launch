<launch>
  
  <arg name="input" default="/pcl_stream" />

  <node pkg="nodelet" type="nodelet" name="pcl_manager" args="manager" output="screen" />

  <!-- Dropping -->
  <!-- Kinect runs around 7hz - dropping 6 out of 7 gets us to ~1hz -->
  <arg name="drop_x" default="6" />
  <arg name="drop_y" default="7" />
  <node name="pipeline_throttle" pkg="pcl_pipeline_utils" type="dropper.py" output="screen"
    args="$(arg input) $(arg drop_x) $(arg drop_y) /pipeline/01_throttled" />

  <!-- Decimation -->
  <arg name="decimation_leafsize_m" default="0.01" />
  <node pkg="nodelet" type="nodelet" name="pipeline_decimation" args="load pcl/VoxelGrid pcl_manager" output="screen">
    <remap from="~input" to="/pipeline/01_throttled" />

    <param name="filter_field_name" type="string" value="z" />
    <param name="filter_limit_min" type="double" value="0.3" />
    <param name="filter_limit_max" type="double" value="5" />
    <param name="filter_limit_negative" type="bool" value="false" />
    <param name="leaf_size" type="double" value="$(arg decimation_leafsize_m)" />

    <remap from="~output" to="/pipeline/02_decimated" />
  </node>

  <!-- Outlier Removal -->
  <arg name="outlier_mean_k" default="10" />
  <arg name="outlier_stddev" default="1.0" />
  <node pkg="nodelet" type="nodelet" name="pipeline_outlier_removal" output="screen"
    args="load pcl/StatisticalOutlierRemoval pcl_manager" >
    <remap from="~input" to="/pipeline/02_decimated" />

    <param name="mean_k" type="int" value="$(arg outlier_mean_k)" />
    <param name="stddev" type="double" value="$(arg outlier_stddev)" />
    <param name="negative" type="bool" value="false" />

    <remap from="~output" to="/pipeline/03_outliers_removed" />
  </node>
  
  <!-- MLS Smoothing -->
  <arg name="mls_search_radius" default="0.3" />
  <node pkg="pcl_pipeline_utils" type="pcl_smoothing" name="pipeline_smoothing" output="screen" >
    <remap from="input" to="/pipeline/03_outliers_removed" />

    <param name="search_radius" type="double" value="$(arg mls_search_radius)" />

    <remap from="output" to="/pipeline/04_smoothed" />
  </node>

  <!-- Compression -->

</launch>